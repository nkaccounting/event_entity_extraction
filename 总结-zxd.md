##做了一下數據的統計信息：

C Q的長度，Q的種類和數量

##分层抽样

然後基於原始的帶answer的train.csv，採用了按照Q類型進行分層抽樣的方法，劃分出來了訓練集和驗證集（原本的eval沒有本地的答案）

##训练

經過了幾輪的訓練，稍微有一點點心得

這個金融事件主體抽取的上游任務是事件偵測，相當於做文本分類，分類出21種類型+其他

“其他”對應的answer都是no answer

直接放進去訓練以後

Inference的時候發現，無論是什麼情況，只要遇到“其他”，直接輸出no answer
而不管句子裡有沒有某個Q的事件類型都會抽取出東西

我理解模型學到了兩個東西：

其他->必然匹配no answer

每個Q都有answer，模型也不知道什麼時候給no answer

然後事件類型統一都是發生某種負面消息的公司，模型不管Q是什麼，都輸出發生某種負面消息的公司

評測結果為：

    {
        "exact": 87.99102132435466,
        "f1": 90.715851918643,
        "total": 1782,
        "HasAns exact": 85.42234332425068,
        "HasAns f1": 88.73000553066876,
        "HasAns total": 1468,
        "NoAns exact": 100.0,
        "NoAns fl": 100.0,
        "NoAns total": 314
}

##no answer的改进

我覺得這個no answer學出來沒有意義，還不如定義一個規則，過濾Q為“其他”的數據

於是就把其他的數據刪除，然後在生成（C，Q，A）的時候，按照正常的（C，Q，A）+（C，Q1，no answer）放進模型裡面進行訓練；Q1是從所有問題類型中隨機採樣一個不同於原本Q的問題類型

這樣做，總的has answer和no answer是1:1

但是對於每個Q的類型，has answer和no answer要看原本的數量和隨機情況

（可能可以按每種Q都是1:1的方法來優化
潛在的問題隨機的Q可能有答案，但較少情況會出現）
這樣訓練下來，模型可以對不包含的事件類型，輸出no answer了

評測結果為：

    {
        "exact": 91.79155313351498,
        "fl": 93.21976089884444,
        "total": 2936,
        "HasAns exact": 86.78474114441417,
        "HasAns f": 89.641156675073,
        "HasAns total": 1468,
        "NoAns exact": 96.7983651226158,
        "NoAns fl": 96.7983651226158,
        "NoAns total": 1468
}

##做了一下wrong analysis：

對於預測不准的數據，感覺模型傾向於抽取靠近clue近的實體，還有就是基於訓練的answer長度，1-4長度的居多，模型也會傾向於抽取出短實體）

一個感覺就是MRC實際上沒有真正理解語言，一些有兩個公司比較，有對抗的情況，就會表現不好

##最後inference了幾條網上找的數據

隨機query查詢

    QAInput('高管負面', '今年6月，經檢察機關批准，廣州警方以涉嫌組織、領導傳銷活動罪對雲聯惠公司實際控制人黃某等主要犯罪嫌疑人執行逮捕'), 雲聯惠公司，正確抽取
    QAInput('我愛你', '今年6月，經檢察機關批准，廣州警方以涉嫌組織、領導傳銷活動罪對雲聯惠公司實際控制人黃某等主要犯罪嫌疑人執行逮捕'),空，正確抽取
    QAInput('業績下滑', '今年6月，經檢察機關批准，廣州警方以涉嫌組織、領導傳銷活動罪對雲聯惠公司實際控制人黃某等主要犯罪嫌疑人執行逮捕'), 空，正確抽取
    QAInput('蜜雪冰城甜蜜蜜', '今年6月，經檢察機關批准，廣州警方以涉嫌組織、領導傳銷活動罪對雲聯惠公司實際控制人黃某等主要犯罪嫌疑人執行逮捕'), 空，正確抽取
    QAInput('營收爆增', '今年6月，經檢察機關批准，廣州警方以涉嫌組織、領導傳銷活動罪對雲聯惠公司實際控制人黃某等主要犯罪嫌疑人執行逮捕'), 空，正確抽取
    QAInput('北京大學', '今年6月，經檢察機關批准，廣州警方以涉嫌組織、領導傳銷活動罪對雲聯惠公司實際控制人黃某等主要犯罪嫌疑人執行逮捕'), 雲聯惠公司（？？？不知道為啥了）
    QAInput('高管正面', '今年6月，經檢察機關批准，廣州警方以涉嫌組織、領導傳銷活動罪對雲聯惠公司實際控制人黃某等主要犯罪嫌疑人執行逮捕'), 雲聯惠公司（學習的泛化性，把營收上漲和下滑視作同一類，不會區別）

面對一個新的query，感覺模型算出來應該是這個Q和之前訓練過的哪個query比較相近，也就是說，在這種訓練下（營收暴增=營收下跌），（高管正面=高管負面）
